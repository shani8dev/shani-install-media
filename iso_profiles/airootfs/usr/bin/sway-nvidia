#!/usr/bin/env sh

# Source profile (lifted from some GNOME stuff)
if [ "x$XDG_SESSION_TYPE" = "xwayland" ] &&
   [ "x$XDG_SESSION_CLASS" != "xgreeter" ] &&
   [ -n "$SHELL" ] &&
   grep -q "$SHELL" /etc/shells &&
   ! (echo "$SHELL" | grep -q "false") &&
   ! (echo "$SHELL" | grep -q "nologin"); then
  if [ "$1" != '-l' ]; then
    exec bash -c "exec -l '$SHELL' -c '$0 -l $*'"
  else
    shift
  fi
fi

# Detect if we are running on NVIDIA hardware.
# We check if the "lspci" command is available and then search for "nvidia" in its output.
if command -v lspci >/dev/null 2>&1 && lspci | grep -iq nvidia; then
  for n in "/usr/share" "/usr/local/share"; do
    [ -f "$n/wlroots-nvidia/wlroots-env-nvidia.sh" ] && . "$n/wlroots-nvidia/wlroots-env-nvidia.sh"
    [ -f "$n/wlroots-nvidia/wlroots-env.sh" ] && . "$n/wlroots-nvidia/wlroots-env.sh"
  done
fi

# noscanout fixes this issue:
# https://www.reddit.com/r/swaywm/comments/wiq06i/games_have_lines_on_screen_when_fullscreen_on/
exec sway --unsupported-gpu -D noscanout "$@"

